--[[ Main

getgenv().enabled = true -- Toggle true/false
getgenv().filluseteamcolor = true -- Toggle fill color using player team color true/false
getgenv().outlineuseteamcolor = true -- Toggle outline color using player team color true/false
getgenv().fillcolor = Color3.new(0, 0, 0) -- Change fill color, no need to edit if using team color
getgenv().outlinecolor = Color3.new(1, 1, 1) -- Change outline color, no need to edit if using team color
getgenv().filltrans = 0.5 -- Change fill transparency
getgenv().outlinetrans = 0.5 -- Change outline transparency

loadstring(game:HttpGet("https://raw.githubusercontent.com/Vcsk/RobloxScripts/main/Highlight-ESP.lua"))()

]]

local Players = game:GetService("Players")
local player = game.Players.LocalPlayer
local userInputService = game:GetService("UserInputService")
local runService = game:GetService("RunService")
local holder = game.CoreGui:FindFirstChild("ESPHolder") or Instance.new("Folder")
if enabled == false then
    holder:Destroy()
end

if holder.Name == "Folder" then
    holder.Name = "ESPHolder"
    holder.Parent = game.CoreGui
end

if uselocalplayer == false and holder:FindFirstChild(game.Players.LocalPlayer.Name) then
    holder:FindFirstChild(game.Players.LocalPlayer.Name):Destroy()
end

if getgenv().enabled == true then 
    getgenv().enabled = false
    getgenv().enabled = true
end
game:GetService("RunService").Heartbeat:Connect(function()
    if getgenv().enabled then
        task.wait()
        for _,v in pairs(game.Players:GetChildren()) do
            local chr = v.Character
            if chr ~= nil then
                local esp = holder:FindFirstChild(v.Name) or Instance.new("Highlight")
                esp.Name = v.Name
                if uselocalplayer == false and esp.Name == game.Players.LocalPlayer.Name then
                    else
                esp.Parent = holder
                if filluseteamcolor then
                    esp.FillColor = v.TeamColor.Color
                else
                    esp.FillColor = fillcolor 
                end
                if outlineuseteamcolor then
                    esp.OutlineColor = v.TeamColor.Color
                else
                    esp.OutlineColor = outlinecolor    
                end
                esp.FillTransparency = filltrans
                esp.OutlineTransparency = outlinetrans
                esp.Adornee = chr
                esp.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop

                local billboard = Instance.new("BillboardGui", character)
                billboard.Adornee = character:FindFirstChild("Head")
                billboard.Size = UDim2.new(0, 200, 0, 50)
                billboard.StudsOffset = Vector3.new(0, 2, 0)
                billboard.AlwaysOnTop = true

                local textLabel = Instance.new("TextLabel", billboard)
                textLabel.Size = UDim2.new(1, 0, 1, 0)
                textLabel.BackgroundTransparency = 1
                textLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
                textLabel.Font = Enum.Font.GothamBold
                textLabel.TextSize = 14
                textLabel.TextStrokeTransparency = 0.5
                textLabel.Text = "Loading..."
                espObjects[character] = {highlight, billboard, textLabel}
    end
end

local function updateESP()
    for _, plr in pairs(game.Players:GetPlayers()) do

        if plr ~= player and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
            local char = plr.Character
            local rootPart = char:FindFirstChild("HumanoidRootPart")
            local humanoid = char:FindFirstChild("Humanoid")
            local espData = espObjects[char]

            if rootPart and humanoid and espData then
                local distance = (rootPart.Position - player.Character.HumanoidRootPart.Position).Magnitude
                local health = math.floor(humanoid.Health)
                local maxHealth = math.floor(humanoid.MaxHealth)
                espData[3].Text = string.format("%.1fm | %d/%d HP | %s", distance, health, maxHealth, plr.Name)
            end
        end
    end
end
end)
